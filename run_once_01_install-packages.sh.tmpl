#!/bin/bash
{{ if eq .chezmoi.os "darwin" -}}

set -e

echo "ğŸº Starting Homebrew setup for macOS..."

# Install Homebrew if not installed
if ! which brew > /dev/null 2>&1 ; then
  echo "ğŸ“¦ Installing Homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

  # Add Homebrew to PATH for Apple Silicon
  if [ -e /opt/homebrew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  fi
else
  echo "âœ… Homebrew is already installed"
fi

# Disable Homebrew analytics
echo "ğŸ”’ Disabling Homebrew analytics..."
brew analytics off

# Update Homebrew
echo "ğŸ”„ Updating Homebrew..."
brew update

# Install packages using Brewfile
echo "ğŸ“¦ Installing packages from Brewfile..."
brew bundle --file="$HOME/.config/homebrew/Brewfile"

# Setup auto-update
echo "âš™ï¸  Setting up Homebrew auto-update..."
brew autoupdate start

echo "âœ¨ Homebrew setup completed!"

{{ end -}}
