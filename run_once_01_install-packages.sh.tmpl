#!/bin/bash
{{ if eq .chezmoi.os "darwin" -}}

set -e

echo "üç∫ Starting Homebrew setup for macOS..."

# Install Homebrew if not installed
if ! which brew > /dev/null 2>&1 ; then
  echo "üì¶ Installing Homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

  # Add Homebrew to PATH for Apple Silicon
  if [ -e /opt/homebrew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  fi
else
  echo "‚úÖ Homebrew is already installed"
fi

# Disable Homebrew analytics
echo "üîí Disabling Homebrew analytics..."
brew analytics off

# Update and upgrade Homebrew
echo "üîÑ Updating Homebrew..."
brew update
brew upgrade

# Install CLI tools
echo "üì¶ Installing CLI tools..."
brew install chezmoi
brew install gist
brew install git
brew install git-extras
brew install peco
brew install tig
brew install highlight
brew install tmux
brew install mysql
brew install mycli
brew install pgcli
brew install yarn
brew install zsh
brew install ffmpeg
brew install htop
brew install jq
brew install wget
brew install coreutils
brew install tree
brew install bat
brew install reattach-to-user-namespace
brew install terminal-notifier
brew install ghq
brew install direnv
brew install trash
brew install awscli
brew install gh
brew install imagemagick
brew install deno
brew install yt-dlp
brew install jnv

# Install development tools
echo "üîß Installing development tools..."
brew install shellcheck
brew install hadolint
brew install trivy
brew install go
brew install node
brew install pyenv

# Install Terraform
echo "üîß Installing Terraform..."
brew tap hashicorp/tap
brew install hashicorp/tap/terraform

# Install GUI applications
echo "üñ•Ô∏è  Installing GUI applications..."
brew install --cask iterm2
brew install --cask docker
brew install --cask google-chrome
brew install --cask google-japanese-ime
brew install --cask appcleaner
brew install --cask spotify
brew install --cask visual-studio-code
brew install --cask jetbrains-toolbox
brew install --cask karabiner-elements
brew install --cask alfred
brew install --cask firefox
brew install --cask vlc
brew install --cask dropbox
brew install --cask google-cloud-sdk
brew install --cask clipy
brew install --cask audacity
brew install --cask elgato-stream-deck
brew install --cask 1password
brew install --cask rambox

# Install Mac App Store apps
echo "üçé Installing Mac App Store apps..."
brew install mas

mas install 409183694   # Keynote
mas install 803453959   # Slack
mas install 539883307   # LINE
mas install 441258766   # Magnet
mas install 497799835   # XCode
mas install 490505997   # Skitch
mas install 405399194   # Kindle
mas install 1429033973  # Runcat
mas install 1291898086  # toggl-track

# Setup auto-update
echo "‚öôÔ∏è  Setting up Homebrew auto-update..."
brew tap homebrew/autoupdate
brew autoupdate start

echo "‚ú® Homebrew setup completed!"

{{ end -}}
