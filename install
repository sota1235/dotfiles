#!/bin/sh

### functions and alias for instalation ###
function cecho {
  if [ $OS == 'Lunux' ]; then
    echo -e "\e[34m$*\e[m";
  elif [ $OS == 'Mac' ]; then
    printf "\033[34m$*\033[0m\n";
  else
    # TODO: Cygwinの際のecho
    echo -e "\e[34m$*\e[m";
  fi
}

# GNUとBSDのsedの挙動の違いを吸収
if sed --version 2>/dev/null | grep -q GNU; then
  alias sedi='sed -i '
else
  alias sedi='sed -i "" '
fi

###
# Start install
###
echo '.----.  .----.  .---.   .----..-..-.   .----. .----.'
echo '| {}  \/  {}  \{_   _}  | {_  | || |   | {_  { {__  '
echo '|     /\      /  | |    | |   | || `--.| {__ .-._} }'
echo '`----   `----    `-     `-    `- `---- `---- `----  '

echo "(*'-') < Start install the dotfiles"

###
# judge OS
###
if [ "$(uname)" == 'Darwin' ]; then
  OS='Mac'
elif [ "$(expr substr $(uname -s) 1 5)" == 'Linux' ]; then
  OS='Linux'
elif [ "$(expr substr $(uname -s) 1 10)" == 'MINGW32_NT' ]; then
  OS='Cygwin'
else
  echo "Your platform ($(uname -a)) is not supported."
  exit 1
fi

###
# Vim Setup
###

cecho "Starting Vim setup"

# backup the vim files
if [ -e ~/.vimrc ]; then
  cp ~/.vimrc ~/.vimrc.backup
fi

# make the vim files
cp `pwd`/vim/vimrc ~/.vimrc

###
# Git Setup
###

cecho "Starting Git setup"

# backup the git files
if [ -e ~/.gitconfig ]; then
  cp ~/.gitconfig ~/.gitconfig.backup
fi
if [ -e ~/.gitconfig_local ]; then
  cp ~/.gitconfig_local ~/.gitconfig_local.backup
fi
if [ -e ~/.gitignore ]; then
  cp ~/.gitignore ~/.gitignore.backup
fi

# make the git files
cp `pwd`/gitfiles/gitignore ~/.gitignore
cp `pwd`/gitfiles/gitconfig ~/.gitconfig

# make original gitconfig_local file
GIT_NAME=""
GIT_MAIL=""
cecho "Please enter your GitHub name"
/bin/echo -n "> "
read GIT_NAME
cecho "Please enter your GitHub e-mail address"
/bin/echo -n "> "
read GIT_MAIL

cp `pwd`/gitfiles/gitconfig_local ~/.gitconfig_local
sedi s/{git_user_name}/${GIT_NAME}/g     ~/.gitconfig_local
sedi s/{git_email_address}/${GIT_MAIL}/g ~/.gitconfig_local

###
# Zsh Setup
###

# include alias.zsh
cecho "Starting zsh setup"

# backup the zsh files
if [ -e ~/.zshrc ]; then
  cp ~/.zshrc  ~/.zshrc.backup
fi
if [ -e ~/.zshenv ]; then
  cp ~/.zshenv ~/.zshenv.backup
fi

# cp zsh files
cp `pwd`/zsh/zshrc.zsh ~/.zshrc
cp `pwd`/zsh/zshenv.zsh ~/.zshenv

# make PATH file
if [ -e $HOME/.zsh_paths ]; then
  touch $HOME/.zsh_paths
fi

###
# tmux Setup
###

cecho "Startging tmux setup"

# backup .tmux.conf
if [ -e ~/.tmux.conf ]; then
  cp ~/.tmux.conf ~/.tmux.conf.backup
fi

# cp tmux.conf
cp `pwd`/tmux/tmux.conf ~/.tmux.conf

cecho "Installation is completed"

exec zsh
